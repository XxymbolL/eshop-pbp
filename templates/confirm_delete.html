<div id="DeleteOverlay" class="fixed inset-0 bg-black/40 hidden z-40"></div>

<div id="DeleteSheet" class="fixed inset-x-0 bottom-0 md:inset-auto md:top-1/2 md:left-1/2 md:-translate-x-1/2 md:-translate-y-1/2 w-full md:w-[480px] bg-white border border-gray-200 rounded-t-2xl md:rounded-2xl shadow-xl hidden z-50">
  <div class="p-6">
    <h3 class="text-lg font-semibold mb-2">Delete product</h3>
    <p id="DeleteText" class="text-gray-700 mb-6">Are you sure you want to delete this item?</p>

    <div id="DeleteErrors" class="hidden text-sm text-red-700 bg-red-50 border border-red-200 rounded p-3 mb-4"></div>

    <div class="flex flex-col sm:flex-row gap-3">
      <button id="DeleteCancel" class="px-4 py-2 border rounded hover:bg-gray-100">Cancel</button>
      <button id="DeleteConfirm" class="flex-1 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">Delete</button>
    </div>
  </div>
</div>

<script>
  const URL_DELETE = "{% url 'main:delete_shoes_ajax' '00000000-0000-0000-0000-000000000000' %}";

  const delOverlay = document.getElementById('DeleteOverlay');
  const delSheet = document.getElementById('DeleteSheet');
  const delText = document.getElementById('DeleteText');
  const delErrors = document.getElementById('DeleteErrors');
  const btnDelCancel = document.getElementById('DeleteCancel');
  const btnDelConfirm = document.getElementById('DeleteConfirm');

  let delId = null;

  function openDelete() {
    delOverlay.classList.remove('hidden');
    delSheet.classList.remove('hidden');
  }
  function closeDelete() {
    delOverlay.classList.add('hidden');
    delSheet.classList.add('hidden');
    delErrors.classList.add('hidden');
    delErrors.innerHTML = '';
    delId = null;
  }

  delOverlay.addEventListener('click', closeDelete);
  btnDelCancel.addEventListener('click', closeDelete);

  window.openDeleteConfirm = function (id, name) {
    delId = id;
    delText.textContent = 'Delete “' + name + '”? This action cannot be undone.';
    openDelete();
  };

  btnDelConfirm.addEventListener('click', async function () {
    if (!delId) return;
    btnDelConfirm.disabled = true;
    delErrors.classList.add('hidden');
    delErrors.innerHTML = '';

    try {
      const url = URL_DELETE.replace('00000000-0000-0000-0000-000000000000', delId);
      const resp = await fetch(url, {
        method: 'POST',
        headers: { 'X-CSRFToken': getCSRF() },
        credentials: 'same-origin'
      });
      const data = await resp.json().catch(() => ({}));

      if (resp.ok && data.ok) {
        if (window.showToast) showToast('Deleted');
        closeDelete();
        if (typeof loadList === 'function') {
          loadList();
        } else {
          window.location.reload();
        }
      } else {
        const msg = data.error || 'Delete failed';
        delErrors.textContent = msg;
        delErrors.classList.remove('hidden');
        if (window.showToast) showToast('Delete failed');
      }
    } catch (e) {
      console.error(e);
      delErrors.textContent = 'Network error. Please try again.';
      delErrors.classList.remove('hidden');
      if (window.showToast) showToast('Network error');
    } finally {
      btnDelConfirm.disabled = false;
    }
  });
</script>
